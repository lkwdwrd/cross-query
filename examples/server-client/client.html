<!Doctype html>
<html>
	<head>
		<title>Send data from client to server</title>
	</head>
	<body>
		<h1>Cross Query "Client"</h1>
		<h2>server to client example</h2>
		<h3>You've sent:</h3>
		<div id="sent-data"></div>
		<script type="text/javascript" src="../js/deferred.min.js"></script>
		<script type="text/javascript" src="../../build/xqClient.min.js"></script>
		<script id="example-script" type="text/javascript">
			(function(){
				//Vars and some cached element references.
				var serverFrame, result = document.getElementById('sent-data'),
					frameURL = 'http://lkwdwrd.github.io/cross-query/examples/server-client/server.html';
					frameArgs = {
						width: '90%',
						height: 250,
						frameBorder: 1,
						style: 'margin: 0 auto; display: block;'
					};
				/**
				 * Escapes entities in a string to prevent injection. Adapted from Underscorejs.
				 * 
				 * @param  {string} string The string to escape
				 * @return {string}        The escaped string.
				 */
				function escapeText(string) {
					var entityMap = {
						'&': '&amp;',
						'<': '&lt;',
						'>': '&gt;',
						'"': '&quot;',
						"'": '&#x27;'
					};
					var entityReg = /[&<>"']/g;

					if (string == null) return '';
					return ( '' + string ).replace( entityReg, function(match) {
						return entityMap[match];
					});
				};
				/**
				 * Send data to the frame using Cross Query.
				 * 
				 * @return {void}
				 */
				function recieveData( data ){
					result.innerHTML = result.innerHTML + '<p>' + escapeText( data ) + '</p>';
				}
				// OK, we have all the pieces, fire up Cross Query and attach the event to the button.
				serverFrame = xq( frameURL, frameArgs );
				serverFrame.query( {action: 'openConnection' }, { timeout: -1 } )
					.progress( recieveData );
			})();
		</script>
	</body>
</html>