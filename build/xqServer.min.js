/*! Cross Query - v0.1.0
 * 
 * Copyright (c) 2014; * Licensed GPLv2+ */
window.xqServer=function(a,b){"use strict";function c(a,b){var c;b instanceof Array&&(m=b);for(c in a)"function"==typeof a[c]&&(n[c]=a[c]);return h(),{addAction:e,removeAction:f}}function d(a){var b,c,d,e=a.origin;if(-1!==j(m,e)){b=a.data,d={sendSuccess:g(!0,e,b),sendFail:g(!1,e,b),sendNotification:g("notify",e,b)};try{if(!b)return void d.sendFail({error:"Unable to decode data"});c=JSON.parse(b)}catch(f){return void d.sendFail({error:"Unable to decode data"})}return"ping"===c.action?void h():c.action&&n[c.action]?void n[c.action].call(d,c.data,e):void d.sendFail({error:"No callable action"})}}function e(a,b){"string"==typeof a&&"function"==typeof b&&(n[a]=b)}function f(a){"string"==typeof a&&n[a]&&delete n[a]}function g(a,b,c){return function(d){var e={success:a,key:c,url:o,data:d};p.postMessage(JSON.stringify(e),b)}}function h(){k=b.referrer.match(/^(https?:\/\/[^\/]*).*?/),k=k?k[1]:"*",l=!0,p.postMessage(JSON.stringify({init:"xq-init",server:o}),k)}function i(){l&&p.postMessage(JSON.stringify({init:"xq-de-init",server:o}),k)}function j(a,b){var c,d;if(Array.prototype.indexOf)return a.indexOf(b);for(c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}var k,l=!1,m=[],n={},o=a.location.toString(),p=a.opener?a.opener:a.parent;return a.addEventListener?(a.addEventListener("message",d,!1),a.addEventListener("unload",i,!1)):a.attachEvent&&(a.attachEvent("onmessage",d),a.attachEvent("onunload",i)),c}(window,document);