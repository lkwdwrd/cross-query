/*! Cross Query - v0.0.8
 * 
 * Copyright (c) 2014; * Licensed GPLv2+ */
window.xqServer=function(a,b){"use strict";function c(a,b){var c;b instanceof Array&&(o=b);for(c in a)"function"==typeof a[c]&&(p[c]=a[c]);return i(),{addAction:e,removeAction:f,registerShutdown:g}}function d(a){var b,c,d,e=a.origin;if(-1!==l(o,e)){b=a.data,d={sendSuccess:h(!0,e,b),sendFail:h(!1,e,b),sendNotification:h("notify",e,b)};try{if(!b)return d.sendFail({error:"Unable to decode data"}),void 0;c=JSON.parse(b)}catch(f){return d.sendFail({error:"Unable to decode data"}),void 0}return"ping"===c.action?(i(),void 0):c.action&&p[c.action]?(p[c.action].call(d,c.data,e),void 0):(d.sendFail({error:"No callable action"}),void 0)}}function e(a,b){"string"==typeof a&&"function"==typeof b&&(p[a]=b)}function f(a){"string"==typeof a&&p[a]&&delete p[a]}function g(a,b){"function"==typeof a&&q.push({method:a,data:b})}function h(a,b,c){return function(d){var e={success:a,key:c,url:r,data:d};s.postMessage(JSON.stringify(e),b)}}function i(){m=b.referrer.match(/^(https?:\/\/[^\/]*).*?/),m=m?m[1]:"*",n=!0,s.postMessage(JSON.stringify({init:"xq-init",server:r}),m)}function j(){n&&(k(),s.postMessage(JSON.stringify({init:"xq-de-init",server:r}),m))}function k(){var a,b;for(a=0,b=q.length;b>a;a++)q[a].method(q[a].data)}function l(a,b){var c,d;if(Array.prototype.indexOf)return a.indexOf(b);for(c=0,d=a.length;d>c;c++)if(b===a[c])return c;return-1}var m,n=!1,o=[],p={},q=[],r=a.location.toString(),s=a.opener?a.opener:a.parent;return a.addEventListener?(a.addEventListener("message",d,!1),a.addEventListener("unload",j,!1)):a.attachEvent&&(a.attachEvent("onmessage",d),a.attachEvent("onunload",j)),c}(window,document);